{
  "title": "About Frame Integrations",
  "story": [
    {
      "type": "paragraph",
      "id": "6ff6d374a11a6370",
      "text": "The Frame plugin offers several hooks for authors interested in extending the behavior of federated wiki. JavaScript programs in the framed content can use the postMessage() protocol to tell the wiki client to follow a collaborative link, create a ghost page, or import pages into the hosting wiki."
    },
    {
      "type": "paragraph",
      "id": "855bf39f7522b7aa",
      "text": "Each button in this example demonstrates a different integration. Example code behind the buttons are provided below."
    },
    {
      "type": "frame",
      "id": "8c64eddb2eeb0fb9",
      "text": "PLUGIN frame/integrations.html"
    },
    {
      "type": "paragraph",
      "id": "3026a5a65dfe6cff",
      "text": "Note: The keepLineup property enables the button inside the frame to treat the shift key the same way wiki readers have come to expect from links and buttons."
    },
    {
      "type": "markdown",
      "id": "eadb61e1eb8c3cd3",
      "text": "# Open an Existing Page"
    },
    {
      "type": "code",
      "id": "63f623e58e40ba66",
      "text": "document.querySelector(\"button\")\n  .addEventListener(\"click\", event => {\n    window.parent.postMessage({\n      action:\"doInternalLink\",\n      title: \"About Frame Plugin\",\n      keepLineup: event.shiftKey\n    }, \"*\");\n  });"
    },
    {
      "type": "markdown",
      "id": "5a7e5c8ab791e977",
      "text": "# Open a Remote Page\n"
    },
    {
      "type": "code",
      "id": "59166c7782025ace",
      "text": "document.querySelector(\"button\")\n  addEventListener(\"click\", event => {\n    window.parent.postMessage({\n      action:\"doInternalLink\",\n      title: \"Apparatus\",\n      site: \"wiki.dbbs.co\",\n      keepLineup: event.shiftKey\n    }, \"*\")\n})"
    },
    {
      "type": "markdown",
      "id": "44deb487442b5a87",
      "text": "# Create a Ghost Page"
    },
    {
      "type": "code",
      "id": "d5c957014e3db5ea",
      "text": "document.querySelector(\"button\")\n  .addEventListener(\"click\", event => {\n    window.parent.postMessage({\n      action:\"showResult\",\n      page: {\n        title: \"Hello, World!\", story: [\n        {\n          type: \"paragraph\",\n          text: \"Greetings from frame content!\",\n          id: Math.abs(Math.random()*1e20|0)\n                .toString(16)\n        }\n      ]},\n      keepLineup: event.shiftKey\n    }, \"*\");\n  });"
    },
    {
      "type": "markdown",
      "id": "5a6b8c587141a3eb",
      "text": "# Import Many Pages"
    },
    {
      "type": "code",
      "id": "3de1757fd5b8c9bc",
      "text": "function itemId() {\n  return Math.abs(Math.random()*1e20|0).toString(16)\n}\n\ndocument.querySelector(\"button\")\n  .addEventListener(\"click\", event => {\n    window.parent.postMessage({\n      action:\"importer\",\n      pages: {\n        \"hello-world\": {\n          title: \"Hello, World!\", story: [\n          {\n            type: \"paragraph\",\n            text: \"Greetings from frame content!\",\n            id: itemId()\n          }\n        ]},\n        \"greetings-programs\": {\n          title: \"Greetings, Programs!\", story: [\n          {\n            type: \"paragraph\",\n            text: \"We're inside the MCP cone!\",\n            id: itemId()\n          }\n        ]}\n      },\n      keepLineup: event.shiftKey\n    }, \"*\");\n  });"
    },
    {
      "type": "markdown",
      "id": "94c40a06426258f0",
      "text": "# Send Frame Context"
    },
    {
      "type": "paragraph",
      "id": "abf7af50faf8689a",
      "text": "In some cases, authors construct framed content that needs to know about other items on the hosting page. This requires that the framed content install a message listener to receive the context information, and post a message requesting the frame context."
    },
    {
      "type": "code",
      "id": "a6dfb82dc84c3ac9",
      "text": "window.addEventListener(\"message\", handleFrameContext)\nfunction handleFrameContext ({data}) {\n  console.log(\"message received\", data)\n  if (data.action == \"frameContext\") {\n    window.removeEventListener(\n      \"message\", handleFrameContext)\n    const {pageKey, itemId, origin, site, slug, item, \n      page: {title, story}} = data\n    const items = story.reduce((acc, {type}) => {\n      acc[type] = (acc[type]||0)+1\n      return acc\n    }, {})\n    console.log({title, items})\n  }\n}\n\nwindow.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.postMessage({\n    action: \"sendFrameContext\"\n  }, \"*\")\n)"
    },
    {
      "type": "markdown",
      "id": "e0a9022389d50bd9",
      "text": "\n"
    },
    {
      "type": "markdown",
      "id": "13f5690ca4b8efff",
      "text": "# Resize To Frame Content\n"
    },
    {
      "type": "paragraph",
      "id": "ebddb8b8775d314e",
      "text": "Framed content can ask the wiki client to resize the height on the page to dynamically match the contents."
    },
    {
      "type": "code",
      "id": "3ab76a3abb546568",
      "text": "window.parent.postMessage({\n  action: \"resize\",\n  height: document.body.offsetHeight\n}, \"*\")"
    },
    {
      "type": "markdown",
      "id": "7c056880458c8aef",
      "text": "# URL Includes Identifiers\n"
    },
    {
      "type": "paragraph",
      "id": "c0d50a6155ecdb4c",
      "text": "We anticipate framed content needing information to facilitate collaboration with the wiki client. The following code provides a convenient way to discover the identifiers wiki uses for the page and item which host the framed content."
    },
    {
      "type": "code",
      "id": "dacc2f7fdffebb9e",
      "text": "const identifiers = Object.fromEntries(\n  new URLSearchParams(\n    window.location.hash.substr(1)\n  ).entries()\n)\n\nconsole.log({\n  origin: identifiers.origin,\n  title: identifiers.title,\n  site: identifiers.site,\n  slug: identifiers.slug,\n  pageKey: identifiers.pageKey,\n  itemId: identifiers.itemId\n})"
    },
    {
      "type": "markdown",
      "id": "9aa9a1b638c2bea8",
      "text": "# Request Neighborhood\n"
    },
    {
      "type": "paragraph",
      "id": "41d0fd95469c1b90",
      "text": "An HTML script can ask wiki about the neighborhood. (In this example, we also show an idiom of constructing a promise for the reply from wiki.)"
    },
    {
      "type": "code",
      "id": "deed012616e27435",
      "text": "function requestNeighborhood() {\n  return new Promise((resolve, reject) => {\n    window.addEventListener(\"message\", neighborhood)\n    function neighborhood({data}) {\n      if (data.action != \"neighborhood\") return\n      window.removeEventListener(\n        \"message\", neighborhood)\n      resolve(data.neighborhood)\n    }\n    window.parent.postMessage({\n      action: \"requestNeighborhood\"\n    }, \"*\") \n  })\n}\ndocument.querySelector(\"button\")\n .addEventListener(\"click\", async () => {\n  let neighbors = await requestNeighborhood()\n  console.log({neighbors})\n})\n"
    },
    {
      "type": "paragraph",
      "id": "f9588b75ae06132f",
      "text": "There are many other resources around the federation about extending wiki in interesting and novel ways."
    },
    {
      "type": "reference",
      "id": "0a9a10dbad6de97e",
      "site": "ward.asia.wiki.org",
      "slug": "json-schema",
      "title": "JSON Schema",
      "text": "We define the schema for federated wiki pages to the depth that we know it. We use a BNF-like notation to suggest JSON elements. Any ambiguity will be resolved by examining the example. We close with a brief reflection on the successes of the format."
    },
    {
      "type": "reference",
      "id": "efed4b56d68046d4",
      "site": "ward.asia.wiki.org",
      "slug": "outpost-thinking",
      "title": "Outpost Thinking",
      "text": "We built the federation based on the promiscuous sharing of simple things with the hope that this would lead the community to save indefinitely things worth saving. Within a year we had moved from ruby to node without leaving ruby sites behind. Now, in the federation's ninth year, we consider how this process might be further distributed."
    },
    {
      "type": "reference",
      "id": "c75bdb249c2d20c0",
      "site": "plugins.fed.wiki.org",
      "slug": "about-plugins",
      "title": "About Plugins",
      "text": "We explain federated wiki plugins. We define their role interpreting content, recount our experience writing many, describe principles and strategies for future plugins, and offer a step-by-step guide for new plugin authors. We'll also collect pointers here to good plugins when they emerge."
    }
  ],
  "journal": [
    {
      "type": "create",
      "item": {
        "title": "About Frame Integrations",
        "story": []
      },
      "date": 1603572981338
    },
    {
      "id": "6ff6d374a11a6370",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "6ff6d374a11a6370",
        "text": "The Frame plugin offers several hooks for authors interested in extending the behavior of federated wiki. JavaScript programs in the framed content can use the postMessage() protocol to tell the wiki client to follow a collaborative link, create a ghost page, or import pages into the hosting wiki."
      },
      "date": 1603573104162
    },
    {
      "id": "855bf39f7522b7aa",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "855bf39f7522b7aa",
        "text": "Here is a general example of how to integrate an external page with wiki. Attach a click handler to an element—probably a button or link—in your page. Within the click handler call postMessage() on the window parent with one of three actions and related payloads shown below."
      },
      "after": "6ff6d374a11a6370",
      "date": 1603573108024
    },
    {
      "id": "b7984837dcad6d80",
      "type": "add",
      "item": {
        "type": "code",
        "id": "b7984837dcad6d80",
        "text": "<button>Click Me</button>\n<script>\nconst pageKey = window.frameElement.name;\n\nfunction itemId() {\n  return Math.abs(Math.random()*1e20|0).toString(16)\n}\n\ndocument.querySelector('button')\n  .addEventListener('click', event => {\n    window.parent.postMessage({\n      action: ...\n      ...\n      pageKey,\n      keepLineup: event.shiftKey\n  });\n});\n</script>"
      },
      "after": "855bf39f7522b7aa",
      "date": 1603573110726
    },
    {
      "id": "3026a5a65dfe6cff",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "3026a5a65dfe6cff",
        "text": "Note: The pageKey and keepLineup properties enable the button inside the frame to behave the same way wiki readers have come to expect from links and buttons."
      },
      "after": "b7984837dcad6d80",
      "date": 1603573115187
    },
    {
      "id": "eadb61e1eb8c3cd3",
      "type": "add",
      "item": {
        "type": "markdown",
        "id": "eadb61e1eb8c3cd3",
        "text": "# Open an Existing Page"
      },
      "after": "3026a5a65dfe6cff",
      "date": 1603573118998
    },
    {
      "id": "63f623e58e40ba66",
      "type": "add",
      "item": {
        "type": "code",
        "id": "63f623e58e40ba66",
        "text": "{\n  action:\"doInternalLink\",\n  title: \"About Frame Plugin\",\n  ...\n}"
      },
      "after": "eadb61e1eb8c3cd3",
      "date": 1603573121334
    },
    {
      "id": "5a7e5c8ab791e977",
      "type": "add",
      "item": {
        "type": "markdown",
        "id": "5a7e5c8ab791e977",
        "text": "# Create a Ghost Page"
      },
      "after": "63f623e58e40ba66",
      "date": 1603573123547
    },
    {
      "id": "d5c957014e3db5ea",
      "type": "add",
      "item": {
        "type": "code",
        "id": "d5c957014e3db5ea",
        "text": "{\n  action:\"showResult\",\n  page: {\n    title: \"Hello, World!\", story: [\n    {\n      type: \"paragraph\",\n      text: \"Greetings from frame content!\",\n      id: itemId()\n    }\n  ]},\n  ...\n}"
      },
      "after": "5a7e5c8ab791e977",
      "date": 1603573129928
    },
    {
      "id": "5a6b8c587141a3eb",
      "type": "add",
      "item": {
        "type": "markdown",
        "id": "5a6b8c587141a3eb",
        "text": "# Import Many Pages"
      },
      "after": "d5c957014e3db5ea",
      "date": 1603573134879
    },
    {
      "id": "3de1757fd5b8c9bc",
      "type": "add",
      "item": {
        "type": "code",
        "id": "3de1757fd5b8c9bc",
        "text": "{\n  action:\"import\",\n  pages: {\n    \"hello-world\": {\n      title: \"Hello, World!\", story: [\n      {\n        type: \"paragraph\",\n        text: \"Greetings from frame content!\",\n        id: itemId()\n      }\n    ]},\n    \"greetings-programs\": {\n      title: \"Greetings, Programs!\", story: [\n      {\n        type: \"paragraph\",\n        text: \"We're inside the MCP cone!\",\n        id: itemId()\n      }\n    ]}\n  },\n  ...\n}"
      },
      "after": "5a6b8c587141a3eb",
      "date": 1603573143363
    },
    {
      "id": "f9588b75ae06132f",
      "type": "add",
      "item": {
        "type": "paragraph",
        "id": "f9588b75ae06132f",
        "text": "There are many other resources around the federation about extending wiki in interesting and novel ways."
      },
      "after": "3de1757fd5b8c9bc",
      "date": 1603573149700
    },
    {
      "id": "0a9a10dbad6de97e",
      "type": "add",
      "item": {
        "type": "reference",
        "id": "0a9a10dbad6de97e",
        "site": "ward.asia.wiki.org",
        "slug": "json-schema",
        "title": "JSON Schema",
        "text": "We define the schema for federated wiki pages to the depth that we know it. We use a BNF-like notation to suggest JSON elements. Any ambiguity will be resolved by examining the example. We close with a brief reflection on the successes of the format."
      },
      "after": "f9588b75ae06132f",
      "date": 1603573152833
    },
    {
      "id": "efed4b56d68046d4",
      "type": "add",
      "item": {
        "type": "reference",
        "id": "efed4b56d68046d4",
        "site": "ward.asia.wiki.org",
        "slug": "outpost-thinking",
        "title": "Outpost Thinking",
        "text": "We built the federation based on the promiscuous sharing of simple things with the hope that this would lead the community to save indefinitely things worth saving. Within a year we had moved from ruby to node without leaving ruby sites behind. Now, in the federation's ninth year, we consider how this process might be further distributed."
      },
      "after": "0a9a10dbad6de97e",
      "date": 1603573155347
    },
    {
      "id": "c75bdb249c2d20c0",
      "type": "add",
      "item": {
        "type": "reference",
        "id": "c75bdb249c2d20c0",
        "site": "plugins.fed.wiki.org",
        "slug": "about-plugins",
        "title": "About Plugins",
        "text": "We explain federated wiki plugins. We define their role interpreting content, recount our experience writing many, describe principles and strategies for future plugins, and offer a step-by-step guide for new plugin authors. We'll also collect pointers here to good plugins when they emerge."
      },
      "after": "efed4b56d68046d4",
      "date": 1603573161478
    },
    {
      "type": "edit",
      "id": "63f623e58e40ba66",
      "item": {
        "type": "code",
        "id": "63f623e58e40ba66",
        "text": "document.querySelector('button')\n  .addEventListener('click', event => {\n    window.parent.postMessage({\n      action:\"doInternalLink\",\n      title: \"About Frame Plugin\",\n      keepLineup: event.shiftKey\n  });\n});"
      },
      "date": 1613845168818
    },
    {
      "type": "edit",
      "id": "d5c957014e3db5ea",
      "item": {
        "type": "code",
        "id": "d5c957014e3db5ea",
        "text": "function itemId() {\n  return Math.abs(Math.random()*1e20|0).toString(16)\n}\n\ndocument.querySelector('button')\n  .addEventListener('click', event => {\n    window.parent.postMessage({\n      action:\"showResult\",\n      page: {\n        title: \"Hello, World!\", story: [\n        {\n          type: \"paragraph\",\n          text: \"Greetings from frame content!\",\n          id: itemId()\n        }\n      ]},\n      keepLineup: event.shiftKey\n  });\n});"
      },
      "date": 1613845241428
    },
    {
      "type": "edit",
      "id": "d5c957014e3db5ea",
      "item": {
        "type": "code",
        "id": "d5c957014e3db5ea",
        "text": "document.querySelector('button')\n  .addEventListener('click', event => {\n    window.parent.postMessage({\n      action:\"showResult\",\n      page: {\n        title: \"Hello, World!\", story: [\n        {\n          type: \"paragraph\",\n          text: \"Greetings from frame content!\",\n          id: Math.abs(Math.random()*1e20|0).toString(16)\n        }\n      ]},\n      keepLineup: event.shiftKey\n  });\n});"
      },
      "date": 1613845286351
    },
    {
      "type": "edit",
      "id": "d5c957014e3db5ea",
      "item": {
        "type": "code",
        "id": "d5c957014e3db5ea",
        "text": "document.querySelector('button')\n  .addEventListener('click', event => {\n    window.parent.postMessage({\n      action:\"showResult\",\n      page: {\n        title: \"Hello, World!\", story: [\n        {\n          type: \"paragraph\",\n          text: \"Greetings from frame content!\",\n          id: Math.abs(Math.random()*1e20|0)\n                .toString(16)\n        }\n      ]},\n      keepLineup: event.shiftKey\n  });\n});"
      },
      "date": 1613845349564
    },
    {
      "type": "edit",
      "id": "3de1757fd5b8c9bc",
      "item": {
        "type": "code",
        "id": "3de1757fd5b8c9bc",
        "text": "function itemId() {\n  return Math.abs(Math.random()*1e20|0).toString(16)\n}\n\ndocument.querySelector('button')\n  .addEventListener('click', event => {\n    window.parent.postMessage({\n      action:\"import\",\n      pages: {\n        \"hello-world\": {\n          title: \"Hello, World!\", story: [\n          {\n            type: \"paragraph\",\n            text: \"Greetings from frame content!\",\n            id: itemId()\n          }\n        ]},\n        \"greetings-programs\": {\n          title: \"Greetings, Programs!\", story: [\n          {\n            type: \"paragraph\",\n            text: \"We're inside the MCP cone!\",\n            id: itemId()\n          }\n        ]}\n      },\n      keepLineup: event.shiftKey\n  });\n});"
      },
      "date": 1613845528378
    },
    {
      "type": "remove",
      "id": "b7984837dcad6d80",
      "date": 1613845541407
    },
    {
      "type": "edit",
      "id": "3026a5a65dfe6cff",
      "item": {
        "type": "paragraph",
        "id": "3026a5a65dfe6cff",
        "text": "Note: The keepLineup property enables the button inside the frame to treat the shift key the same way wiki readers have come to expect from links and buttons."
      },
      "date": 1613845582613
    },
    {
      "type": "edit",
      "id": "855bf39f7522b7aa",
      "item": {
        "type": "paragraph",
        "id": "855bf39f7522b7aa",
        "text": "The following examples attach a click handler to a button in the framed page."
      },
      "date": 1613845663297
    },
    {
      "type": "add",
      "id": "abf7af50faf8689a",
      "item": {
        "type": "paragraph",
        "id": "abf7af50faf8689a",
        "text": "In some cases, authors construct framed content that needs to know about other items on the hosting page."
      },
      "after": "3de1757fd5b8c9bc",
      "date": 1613845794063
    },
    {
      "type": "add",
      "id": "94c40a06426258f0",
      "item": {
        "type": "factory",
        "id": "94c40a06426258f0",
        "text": "# Send Frame"
      },
      "after": "3de1757fd5b8c9bc",
      "date": 1613845803053
    },
    {
      "type": "edit",
      "id": "94c40a06426258f0",
      "item": {
        "type": "markdown",
        "id": "94c40a06426258f0",
        "text": "# Send Frame Context"
      },
      "date": 1613845810733
    },
    {
      "type": "add",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "factory",
        "id": "a6dfb82dc84c3ac9",
        "text": "# code"
      },
      "after": "abf7af50faf8689a",
      "date": 1613845940179
    },
    {
      "type": "edit",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "code",
        "id": "a6dfb82dc84c3ac9",
        "text": "# code goes here"
      },
      "date": 1613845947194
    },
    {
      "type": "edit",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "code",
        "id": "a6dfb82dc84c3ac9",
        "text": "window.addEventListener(\"message\", event => {\n  const {data} = event\n  if (data.action == \"frameContext\") {\n    const {slug, item, page} = data\n    let code = page.story.find(it => it.type == \"code\")\n    console.log(code.text)\n  }\n})\nwindow.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.postMessage({\n    action: \"sendFrameContext\"\n  }, \"*\")\n)"
      },
      "date": 1613846219584
    },
    {
      "type": "edit",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "code",
        "id": "a6dfb82dc84c3ac9",
        "text": "window.addEventListener(\"message\", event => {\n  const {data} = event\n  if (data.action == \"frameContext\") {\n    const {site, slug, item, page} = data\n    let code = page.story.find(it => {\n      return it.type == \"code\"\n    })\n    console.log(code.text)\n  }\n})\nwindow.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.postMessage({\n    action: \"sendFrameContext\"\n  }, \"*\")\n)"
      },
      "date": 1613846255056
    },
    {
      "type": "edit",
      "id": "abf7af50faf8689a",
      "item": {
        "type": "paragraph",
        "id": "abf7af50faf8689a",
        "text": "In some cases, authors construct framed content that needs to know about other items on the hosting page. This requires that the framed content install a message listener to receive the context information."
      },
      "date": 1613846649036
    },
    {
      "type": "add",
      "id": "e0a9022389d50bd9",
      "item": {
        "type": "factory",
        "id": "e0a9022389d50bd9",
        "text": "# URL Identifiers "
      },
      "after": "a6dfb82dc84c3ac9",
      "date": 1613847011580
    },
    {
      "type": "edit",
      "id": "e0a9022389d50bd9",
      "item": {
        "type": "markdown",
        "id": "e0a9022389d50bd9",
        "text": "# URL Includes Identifiers"
      },
      "date": 1613847033999
    },
    {
      "id": "8c64eddb2eeb0fb9",
      "type": "add",
      "item": {
        "type": "frame",
        "id": "8c64eddb2eeb0fb9",
        "text": "//dobbs.github.io/wiki-plugin-frame/assets/integrations.html\nHEIGHT 350"
      },
      "after": "855bf39f7522b7aa",
      "date": 1613849646493
    },
    {
      "type": "edit",
      "id": "e0a9022389d50bd9",
      "item": {
        "type": "markdown",
        "id": "e0a9022389d50bd9",
        "text": "# URL Includes Identifiers\n"
      },
      "date": 1613850742255
    },
    {
      "type": "add",
      "id": "dacc2f7fdffebb9e",
      "item": {
        "type": "factory",
        "id": "dacc2f7fdffebb9e",
        "text": "code"
      },
      "after": "e0a9022389d50bd9",
      "date": 1613850761022
    },
    {
      "type": "edit",
      "id": "dacc2f7fdffebb9e",
      "item": {
        "type": "code",
        "id": "dacc2f7fdffebb9e",
        "text": "# code"
      },
      "date": 1613850767439
    },
    {
      "type": "edit",
      "id": "dacc2f7fdffebb9e",
      "item": {
        "type": "code",
        "id": "dacc2f7fdffebb9e",
        "text": "const identifiers = Object.fromEntries(\n  new URLSearchParams(\n    window.location.hash.substr(1)\n  ).entries()\n)\n\nconsole.log({\n  site: identifiers.site,\n  slug: identifiers.slug,\n  pageKey: identifiers.pageKey,\n  itemId: identifiers.itemId\n})"
      },
      "date": 1613850957366
    },
    {
      "type": "edit",
      "id": "63f623e58e40ba66",
      "item": {
        "type": "code",
        "id": "63f623e58e40ba66",
        "text": "document.querySelector(\"button\")\n  .addEventListener(\"click\", event => {\n    window.parent.postMessage({\n      action:\"doInternalLink\",\n      title: \"About Frame Plugin\",\n      keepLineup: event.shiftKey\n    }, \"*\");\n  });"
      },
      "date": 1613851444912
    },
    {
      "type": "edit",
      "id": "d5c957014e3db5ea",
      "item": {
        "type": "code",
        "id": "d5c957014e3db5ea",
        "text": "document.querySelector(\"button\")\n  .addEventListener(\"click\", event => {\n    window.parent.postMessage({\n      action:\"showResult\",\n      page: {\n        title: \"Hello, World!\", story: [\n        {\n          type: \"paragraph\",\n          text: \"Greetings from frame content!\",\n          id: Math.abs(Math.random()*1e20|0)\n                .toString(16)\n        }\n      ]},\n      keepLineup: event.shiftKey\n    }, \"*\");\n  });"
      },
      "date": 1613851495475
    },
    {
      "type": "edit",
      "id": "3de1757fd5b8c9bc",
      "item": {
        "type": "code",
        "id": "3de1757fd5b8c9bc",
        "text": "function itemId() {\n  return Math.abs(Math.random()*1e20|0).toString(16)\n}\n\ndocument.querySelector(\"button\")\n  .addEventListener(\"click\", event => {\n    window.parent.postMessage({\n      action:\"import\",\n      pages: {\n        \"hello-world\": {\n          title: \"Hello, World!\", story: [\n          {\n            type: \"paragraph\",\n            text: \"Greetings from frame content!\",\n            id: itemId()\n          }\n        ]},\n        \"greetings-programs\": {\n          title: \"Greetings, Programs!\", story: [\n          {\n            type: \"paragraph\",\n            text: \"We're inside the MCP cone!\",\n            id: itemId()\n          }\n        ]}\n      },\n      keepLineup: event.shiftKey\n    }, \"*\");\n  });"
      },
      "date": 1613851532196
    },
    {
      "type": "edit",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "code",
        "id": "a6dfb82dc84c3ac9",
        "text": "window.addEventListener(\"message\", event => {\n  const {data} = event\n  if (data.action == \"frameContext\") {\n    const {site, slug, item, page} = data\n    let code = page.story.find(it => {\n      return it.type == \"code\"\n    })\n    console.log(code.text)\n  }\n})\nfunction handleFrameContext ({data}) {\n  if (data.action == \"frameContext\") {\n    window.removeEventListener(handleFrameContext)\n  }\n    const {site, slug, item, page} = data\n}\n\n\nwindow.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.postMessage({\n    action: \"sendFrameContext\"\n  }, \"*\")\n)"
      },
      "date": 1622315020829
    },
    {
      "type": "edit",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "code",
        "id": "a6dfb82dc84c3ac9",
        "text": "window.addEventListener(\"message\", event => {\n  const {data} = event\n})\nfunction handleFrameContext ({data}) {\n  if (data.action == \"frameContext\") {\n    window.removeEventListener(handleFrameContext)\n      const {site, slug, item, page} = data\n      console.log({\n        title: page.title,\n        items: page.story.map(it => it.type)\n      })\n    }\n  }\n    const {site, slug, item, page} = data\n}\n\n\nwindow.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.postMessage({\n    action: \"sendFrameContext\"\n  }, \"*\")\n)"
      },
      "date": 1622315170618
    },
    {
      "type": "edit",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "code",
        "id": "a6dfb82dc84c3ac9",
        "text": "window.addEventListener(\"message\", handleFrameContext)\nfunction handleFrameContext ({data}) {\n  if (data.action == \"frameContext\") {\n    window.removeEventListener(handleFrameContext)\n    const {site, slug, item, page} = data\n    console.log({\n      title: page.title,\n      items: page.story.map(it => it.type)\n    })\n  }\n}\n\nwindow.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.postMessage({\n    action: \"sendFrameContext\"\n  }, \"*\")\n)"
      },
      "date": 1622315267184
    },
    {
      "type": "edit",
      "id": "8c64eddb2eeb0fb9",
      "item": {
        "type": "frame",
        "id": "8c64eddb2eeb0fb9",
        "text": "//dev.localhost:3000/assets/integrations.html\nHEIGHT 350"
      },
      "date": 1622315551608
    },
    {
      "type": "edit",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "code",
        "id": "a6dfb82dc84c3ac9",
        "text": "window.addEventListener(\"message\", handleFrameContext)\nfunction handleFrameContext ({data}) {\n  console.log(\"message received\", data)\n  if (data.action == \"frameContext\") {\n    window.removeEventListener(\n      \"message\", handleFrameContext)\n    const {site, slug, item, \n      page: {title, story}} = data\n    const items = story.reduce((acc, {type}) => {\n      acc[type] = (acc[type]||0)+1\n      return acc\n    }, {})\n    console.log({title, items})\n  }\n}\n\nwindow.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.postMessage({\n    action: \"sendFrameContext\"\n  }, \"*\")\n)"
      },
      "date": 1622316072296
    },
    {
      "type": "edit",
      "id": "855bf39f7522b7aa",
      "item": {
        "type": "paragraph",
        "id": "855bf39f7522b7aa",
        "text": "Each button in this example demonstrates a different integration. Example code behind the buttons are provided below."
      },
      "date": 1622316224659
    },
    {
      "type": "edit",
      "id": "8c64eddb2eeb0fb9",
      "item": {
        "type": "frame",
        "id": "8c64eddb2eeb0fb9",
        "text": "//dev.localhost:3000/assets/integrations.html\nHEIGHT 375"
      },
      "date": 1622316262595
    },
    {
      "type": "edit",
      "id": "abf7af50faf8689a",
      "item": {
        "type": "paragraph",
        "id": "abf7af50faf8689a",
        "text": "In some cases, authors construct framed content that needs to know about other items on the hosting page. This requires that the framed content install a message listener to receive the context information, and post a message requesting the frame context."
      },
      "date": 1622735901561
    },
    {
      "type": "add",
      "id": "c0d50a6155ecdb4c",
      "item": {
        "type": "markdown",
        "id": "c0d50a6155ecdb4c",
        "text": "We anticipate framed content needing information to facilitate collaboration with the wiki client. The following code provides a convenient way to discover the identifiers wiki uses for the page and item which host the framed content."
      },
      "after": "e0a9022389d50bd9",
      "date": 1622736323110
    },
    {
      "type": "edit",
      "id": "c0d50a6155ecdb4c",
      "item": {
        "type": "paragraph",
        "id": "c0d50a6155ecdb4c",
        "text": "We anticipate framed content needing information to facilitate collaboration with the wiki client. The following code provides a convenient way to discover the identifiers wiki uses for the page and item which host the framed content.  "
      },
      "date": 1622736332760
    },
    {
      "type": "edit",
      "id": "c0d50a6155ecdb4c",
      "item": {
        "type": "paragraph",
        "id": "c0d50a6155ecdb4c",
        "text": "We anticipate framed content needing information to facilitate collaboration with the wiki client. The following code provides a convenient way to discover the identifiers wiki uses for the page and item which host the framed content."
      },
      "date": 1622736337232
    },
    {
      "type": "edit",
      "id": "e0a9022389d50bd9",
      "item": {
        "type": "markdown",
        "id": "e0a9022389d50bd9",
        "text": "\n"
      },
      "date": 1622736345821
    },
    {
      "type": "add",
      "id": "7c056880458c8aef",
      "item": {
        "type": "markdown",
        "id": "7c056880458c8aef",
        "text": "# URL Includes Identifiers\n"
      },
      "after": "e0a9022389d50bd9",
      "date": 1622736348115
    },
    {
      "item": {
        "type": "factory",
        "id": "13f5690ca4b8efff"
      },
      "id": "13f5690ca4b8efff",
      "type": "add",
      "after": "c75bdb249c2d20c0",
      "date": 1622736359926
    },
    {
      "id": "13f5690ca4b8efff",
      "type": "move",
      "order": [
        "6ff6d374a11a6370",
        "855bf39f7522b7aa",
        "8c64eddb2eeb0fb9",
        "3026a5a65dfe6cff",
        "eadb61e1eb8c3cd3",
        "63f623e58e40ba66",
        "5a7e5c8ab791e977",
        "d5c957014e3db5ea",
        "5a6b8c587141a3eb",
        "3de1757fd5b8c9bc",
        "94c40a06426258f0",
        "abf7af50faf8689a",
        "a6dfb82dc84c3ac9",
        "e0a9022389d50bd9",
        "13f5690ca4b8efff",
        "7c056880458c8aef",
        "c0d50a6155ecdb4c",
        "dacc2f7fdffebb9e",
        "f9588b75ae06132f",
        "0a9a10dbad6de97e",
        "efed4b56d68046d4",
        "c75bdb249c2d20c0"
      ],
      "date": 1622736370449
    },
    {
      "type": "edit",
      "id": "13f5690ca4b8efff",
      "item": {
        "type": "markdown",
        "id": "13f5690ca4b8efff",
        "text": "# Resize To Frame Content\n"
      },
      "date": 1622736391351
    },
    {
      "type": "add",
      "id": "ebddb8b8775d314e",
      "item": {
        "type": "factory",
        "id": "ebddb8b8775d314e",
        "text": "xyz"
      },
      "after": "13f5690ca4b8efff",
      "date": 1622736394592
    },
    {
      "type": "edit",
      "id": "ebddb8b8775d314e",
      "item": {
        "type": "paragraph",
        "id": "ebddb8b8775d314e",
        "text": "Framed content can ask the wiki client to resize the height on the page to dynamically match the contents."
      },
      "date": 1622736500647
    },
    {
      "type": "add",
      "id": "3ab76a3abb546568",
      "item": {
        "type": "factory",
        "id": "3ab76a3abb546568",
        "text": "window.parent.postMessage({action:})"
      },
      "after": "ebddb8b8775d314e",
      "date": 1622736525622
    },
    {
      "type": "edit",
      "id": "3ab76a3abb546568",
      "item": {
        "type": "code",
        "id": "3ab76a3abb546568",
        "text": "window.parent.postMessage({\n  action: \"resize\",\n  height: document.body.offsetHeight\n})"
      },
      "date": 1622736585260
    },
    {
      "type": "edit",
      "id": "3ab76a3abb546568",
      "item": {
        "type": "code",
        "id": "3ab76a3abb546568",
        "text": "window.parent.postMessage({\n  action: \"resize\",\n  height: document.body.offsetHeight\n}, \"*\")"
      },
      "date": 1622736860168
    },
    {
      "type": "edit",
      "id": "8c64eddb2eeb0fb9",
      "item": {
        "type": "frame",
        "id": "8c64eddb2eeb0fb9",
        "text": "//dobbs.github.io/wiki-plugin-frame/assets/integrations.html"
      },
      "date": 1622736922764
    },
    {
      "type": "edit",
      "id": "5a7e5c8ab791e977",
      "item": {
        "type": "markdown",
        "id": "5a7e5c8ab791e977",
        "text": "# Open a Remote Page\n"
      },
      "date": 1624562770286
    },
    {
      "type": "add",
      "id": "59166c7782025ace",
      "item": {
        "type": "markdown",
        "id": "59166c7782025ace",
        "text": "// code\n"
      },
      "after": "5a7e5c8ab791e977",
      "date": 1624562789164
    },
    {
      "type": "add",
      "id": "44deb487442b5a87",
      "item": {
        "type": "markdown",
        "id": "44deb487442b5a87",
        "text": "# Create a Ghost Page"
      },
      "after": "59166c7782025ace",
      "date": 1624562790546
    },
    {
      "type": "edit",
      "id": "59166c7782025ace",
      "item": {
        "type": "code",
        "id": "59166c7782025ace",
        "text": "document.querySelector(\"button\")\n  addEventListener(\"click\", event => {\n    window.parent.postMessage({\n      action:\"doInternalLink\",\n      title: \"Apparatus\",\n      site: \"wiki.dbbs.co\",\n      keepLineup: event.shiftKey\n    }, \"*\")\n})"
      },
      "date": 1624562970353
    },
    {
      "type": "edit",
      "id": "dacc2f7fdffebb9e",
      "item": {
        "type": "code",
        "id": "dacc2f7fdffebb9e",
        "text": "const identifiers = Object.fromEntries(\n  new URLSearchParams(\n    window.location.hash.substr(1)\n  ).entries()\n)\n\nconsole.log({\n  title: identifiers.title,\n  site: identifiers.site,\n  slug: identifiers.slug,\n  pageKey: identifiers.pageKey,\n  itemId: identifiers.itemId\n})"
      },
      "date": 1624569311212
    },
    {
      "type": "add",
      "id": "9aa9a1b638c2bea8",
      "item": {
        "type": "factory",
        "id": "9aa9a1b638c2bea8",
        "text": "# Request "
      },
      "after": "dacc2f7fdffebb9e",
      "date": 1628342026910
    },
    {
      "type": "edit",
      "id": "9aa9a1b638c2bea8",
      "item": {
        "type": "markdown",
        "id": "9aa9a1b638c2bea8",
        "text": "# Request Neighborhood\n"
      },
      "date": 1628342045351
    },
    {
      "type": "add",
      "id": "41d0fd95469c1b90",
      "item": {
        "type": "factory",
        "id": "41d0fd95469c1b90",
        "text": "asdf"
      },
      "after": "9aa9a1b638c2bea8",
      "date": 1628342051428
    },
    {
      "type": "edit",
      "id": "41d0fd95469c1b90",
      "item": {
        "type": "paragraph",
        "id": "41d0fd95469c1b90",
        "text": "An HTML script can ask wiki about the neighborhood."
      },
      "date": 1628342117167
    },
    {
      "type": "add",
      "id": "deed012616e27435",
      "item": {
        "type": "factory",
        "id": "deed012616e27435",
        "text": "# "
      },
      "after": "41d0fd95469c1b90",
      "date": 1628342120693
    },
    {
      "type": "edit",
      "id": "deed012616e27435",
      "item": {
        "type": "code",
        "id": "deed012616e27435",
        "text": "document.querySelector(\"button\")\n .addEventListener(\"click\", event => {\npostMessage({}, \"*\") \n})\n"
      },
      "date": 1628342180563
    },
    {
      "type": "edit",
      "id": "deed012616e27435",
      "item": {
        "type": "code",
        "id": "deed012616e27435",
        "text": "function requestNeighborhood() {\n  return new Promise((resolve, reject) => {\n    window.addEventListener(\"message\", neighborhood)\n    function neighborhood({data}) {\n      if (data.action != \"neighborhood\") return\n      window.removeEventListener(\n        \"message\", neighborhood)\n      resolve(data.neighborhood)\n    }\n    window.parent.postMessage({\n      action: \"requestNeighborhood\"\n    }, \"*\") \n  })\n}\ndocument.querySelector(\"button\")\n .addEventListener(\"click\", async () => {\n  let neighborhood = await requestNeighborhood()\n  document.querySelector(\"#neighborhood\")\n    .\n})\n"
      },
      "date": 1628342937379
    },
    {
      "type": "edit",
      "id": "deed012616e27435",
      "item": {
        "type": "code",
        "id": "deed012616e27435",
        "text": "function requestNeighborhood() {\n  return new Promise((resolve, reject) => {\n    window.addEventListener(\"message\", neighborhood)\n    function neighborhood({data}) {\n      if (data.action != \"neighborhood\") return\n      window.removeEventListener(\n        \"message\", neighborhood)\n      resolve(data.neighborhood)\n    }\n    window.parent.postMessage({\n      action: \"requestNeighborhood\"\n    }, \"*\") \n  })\n}\ndocument.querySelector(\"button\")\n .addEventListener(\"click\", async () => {\n  let neighbors = await requestNeighborhood()\n  console.log({neighbors})\n})\n"
      },
      "date": 1628343026340
    },
    {
      "type": "edit",
      "id": "41d0fd95469c1b90",
      "item": {
        "type": "paragraph",
        "id": "41d0fd95469c1b90",
        "text": "An HTML script can ask wiki about the neighborhood. (In this example, we also show an idiom of constructing a promise for the reply from wiki.)"
      },
      "date": 1628343187783
    },
    {
      "type": "edit",
      "id": "8c64eddb2eeb0fb9",
      "item": {
        "type": "frame",
        "id": "8c64eddb2eeb0fb9",
        "text": "PLUGIN frame/integrations.html"
      },
      "date": 1631372547216
    },
    {
      "type": "edit",
      "id": "dacc2f7fdffebb9e",
      "item": {
        "type": "code",
        "id": "dacc2f7fdffebb9e",
        "text": "const identifiers = Object.fromEntries(\n  new URLSearchParams(\n    window.location.hash.substr(1)\n  ).entries()\n)\n\nconsole.log({\n  origin: identifiers.origin,\n  title: identifiers.title,\n  site: identifiers.site,\n  slug: identifiers.slug,\n  pageKey: identifiers.pageKey,\n  itemId: identifiers.itemId\n})"
      },
      "date": 1636212441494
    },
    {
      "type": "edit",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "code",
        "id": "a6dfb82dc84c3ac9",
        "text": "window.addEventListener(\"message\", handleFrameContext)\nfunction handleFrameContext ({data}) {\n  console.log(\"message received\", data)\n  if (data.action == \"frameContext\") {\n    window.removeEventListener(\n      \"message\", handleFrameContext)\n    const {origin, site, slug, item, \n      page: {title, story}} = data\n    const items = story.reduce((acc, {type}) => {\n      acc[type] = (acc[type]||0)+1\n      return acc\n    }, {})\n    console.log({title, items})\n  }\n}\n\nwindow.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.postMessage({\n    action: \"sendFrameContext\"\n  }, \"*\")\n)"
      },
      "date": 1636212493206
    },
    {
      "type": "edit",
      "id": "a6dfb82dc84c3ac9",
      "item": {
        "type": "code",
        "id": "a6dfb82dc84c3ac9",
        "text": "window.addEventListener(\"message\", handleFrameContext)\nfunction handleFrameContext ({data}) {\n  console.log(\"message received\", data)\n  if (data.action == \"frameContext\") {\n    window.removeEventListener(\n      \"message\", handleFrameContext)\n    const {pageKey, itemId, origin, site, slug, item, \n      page: {title, story}} = data\n    const items = story.reduce((acc, {type}) => {\n      acc[type] = (acc[type]||0)+1\n      return acc\n    }, {})\n    console.log({title, items})\n  }\n}\n\nwindow.addEventListener(\n  \"DOMContentLoaded\",\n  () => window.parent.postMessage({\n    action: \"sendFrameContext\"\n  }, \"*\")\n)"
      },
      "date": 1636212550420
    }
  ]
}